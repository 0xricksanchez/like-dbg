FROM debian:bullseye-slim
LABEL maintainer="Christopher Krah <admin@0x434b.dev>"

ENV DEBIAN_FRONTEND noninteractive
WORKDIR /tmp

# Get essentials
RUN apt update && apt upgrade -y && \
    apt install -y vim debootstrap git openssh-server qemu-user-static libc-dev sudo && \
    mkdir -p /var/run/sshd

ENV USER_UID=1000
ENV HOST_GID=1000
ENV USER=dbg
ENV SHELL="/bin/bash"

RUN groupadd -g $HOST_GID $USER && \
    useradd -u $USER_UID -g $HOST_GID -s $SHELL -m -p $(openssl passwd -1 $USER) $USER && \
    usermod -aG sudo $USER

WORKDIR /home/dbg
# Make ssh easy
RUN mkdir .ssh && \
    sed -i '/^$USER/ { s/:x:/::/ }' /etc/passwd

COPY .ssh/like.id_rsa.pub .ssh/authorized_keys
COPY io/scripts/rootfs.sh .
RUN /usr/sbin/sshd 

EXPOSE 22
